"use strict";(()=>{var e={id:179,ids:[179]};e.modules={2757:(e,t,n)=>{var r=n(5826),o=n(3657),i=o.z.object({username:o.z.string().min(1).max(10),age:o.z.number().min(1)}),a=n(6709),u=n(9529),s=n.n(u),l=n(2443),c=n.n(l),f=n(3685),p=n.n(f),d=n(1017),h=n.n(d),v=n(5674),y=n.n(v),b=n(4672),m=n.n(b),w=n(3999),x=n.n(w),g=n(5332),q=n.n(g),S=n(9738),F=n.n(S),k=h().join(__dirname,"../.env");y().ensureFileSync(k),F().config({path:k});var D=process.env,_=h().resolve(__dirname,"../"),E=Number(D.PORT||3e3);process.env.PORT=String(E);var T=Number(D.MAX_FILE_SIZE||1),O=function(e){e.get("/api/test",(function(e){return t=void 0,n=void 0,o=function(){return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}(this,(function(t){return console.log("Testing"),e.body="ok",[2]}))},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,u)}s((o=o.apply(t,n||[])).next())}));var t,n,r,o}))},j=function(e){e.post("/api/upload",(function(e){return t=void 0,n=void 0,o=function(){var t,n,r,o,i;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}(this,(function(a){return t=e.request.files.file,n=t.mimetype,r=t.newFilename,o=t.originalFilename,i=t.size,e.body={mimetype:n,newFilename:r,originalFilename:o,size:i},[2]}))},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,u)}s((o=o.apply(t,n||[])).next())}));var t,n,r,o}))},N=n(3220);var z=n(9664),A=new Set,P=n(2902),U=n(6486),C=n.n(U)().throttle,L=function(){function e(e){var t=this;this.file="",this.version=0,this.autoSaveFile=function(){};var n=e.file,r=e.defaultValue,o=e.version,i=void 0===o?1:o,a=e.versionFixer,u=e.disableAutoSave,s=void 0!==u&&u,l=e.autoSaveWaitMilliseconds,c=void 0===l?8e3:l;this.file=n,this.version=i,this.data=r,s||(this.autoSaveFile=C((function(){t.saveFile()}),c)),this.loadFile(a)}return e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e,this.autoSaveFile()},e.prototype.changeData=function(e){this.data=(0,P.Uy)((function(t){e(t)}))(this.data),this.autoSaveFile()},e.prototype.loadFile=function(e){try{var t=y().readFileSync(this.file,"utf8"),n=JSON.parse(t),r=n.data,o=n.version;this.data=e&&o!==this.version?e(r,o):r}catch(e){console.log("[jsonDb] Error parsing db file, use default value.")}this.saveFile()},e.prototype.saveFile=function(){y().ensureFileSync(this.file),y().writeFileSync(this.file,JSON.stringify({data:this.data,version:this.version,updatedAtString:(new Date).toString(),updatedAtTime:(new Date).getTime()}))},e}();const G=L;var I=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}s((r=r.apply(e,t||[])).next())}))},M=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}},Z=h().resolve(_,"./data/db/main.json"),J={_restartCount:0},R=new G({file:Z,version:1,defaultValue:J,versionFixer:function(e,t){return 1!==t?J:e}});function V(){return I(this,void 0,void 0,(function(){return M(this,(function(e){return R.changeData((function(e){e._restartCount+=1})),[2]}))}))}i.parse({}),function(){var e,t,n,o;e=this,t=void 0,o=function(){var e;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}(this,(function(t){switch(t.label){case 0:return(0,r.Z)("Loading...").start().succeed(),[4,V()];case 1:return t.sent(),function(e){new z.xF(e,{cors:{origin:"*"}}).on("connection",(function(e){var t={socket:e,data:{userId:""}};A.add(t),e.on("login",(function(e){t.data.userId=e,console.log("[socket] User ".concat(e," logged in."))})),e.on("disconnect",(function(){A.delete(t)}))}))}((function(e){e.use(q()()),e.use(new(m()));var t=h().join(_,"html/frontend"),n=h().join(_,"html/resources");y().ensureDirSync(t),y().ensureDirSync(n),e.use(x()(t,{maxAge:2592e6,immutable:!0})),e.use(x()(n,{maxAge:2592e6,immutable:!0})),e.use(c()({jsonLimit:"100mb",multipart:!0,formidable:{uploadDir:_+"/html/resources",maxFileSize:1024*T*1024,multiples:!1,onFileBegin:function(e,t){var n=(t.originalFilename||"").replace(/[\/\\]/g,""),r=h().extname(n),o=h().basename(n,r)+"."+(0,N.x0)()+r;t.newFilename=o,t.filepath=_+"/html/resources/"+o}}}));var r=new(s());e.use(r.routes()),function(e){O(e),j(e)}(r)}(n=new a.Z),e=p().createServer(n.callback()))),e.listen(E,(function(){console.log("listening on port:"+E),console.log("http://localhost:".concat(E))})),[2]}var n}))},new((n=void 0)||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function u(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}s((o=o.apply(e,t||[])).next())}))}()},9491:e=>{e.exports=require("assert")},852:e=>{e.exports=require("async_hooks")},4300:e=>{e.exports=require("buffer")},2057:e=>{e.exports=require("constants")},6113:e=>{e.exports=require("crypto")},3639:e=>{e.exports=require("domain")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},612:e=>{e.exports=require("node:os")},7742:e=>{e.exports=require("node:process")},1747:e=>{e.exports=require("node:readline")},5997:e=>{e.exports=require("node:tty")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},3477:e=>{e.exports=require("querystring")},2781:e=>{e.exports=require("stream")},1576:e=>{e.exports=require("string_decoder")},9512:e=>{e.exports=require("timers")},4404:e=>{e.exports=require("tls")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},6108:e=>{if("undefined"==typeof bufferutil){var t=new Error("Cannot find module 'bufferutil'");throw t.code="MODULE_NOT_FOUND",t}e.exports=bufferutil},1216:e=>{if(typeof utf-8-validate==="undefined"){var t=new Error("Cannot find module 'utf-8-validate'");throw t.code="MODULE_NOT_FOUND",t}e.exports=utf-8-validate}};var t=require("./runtime.js");t.C(e),t.X(0,[216],(()=>(2757,t(t.s=2757))))})();