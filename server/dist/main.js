"use strict";(()=>{var e={id:179,ids:[179]};e.modules={7010:(e,t,n)=>{var r=n(6709),o=n(9529),i=n.n(o),a=n(2443),u=n.n(a),l=n(3685),s=n.n(l),c=n(1017),f=n.n(c),p=n(5674),h=n.n(p),d=n(4672),v=n.n(d),y=n(4270),b=n(3999),w=n.n(b),m=n(5332),x=n.n(m),g=n(9738),S=n.n(g),F=f().join(__dirname,"../.env");h().ensureFileSync(F),S().config({path:F});var q=process.env,k=f().resolve(__dirname,"../"),D=Number(q.PORT||3e3);process.env.PORT=String(D);var _=Number(q.MAX_FILE_SIZE||1),E=function(e){e.get("/api/test",(function(e){return t=void 0,n=void 0,o=function(){return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}(this,(function(t){return console.log("Testing"),e.body="ok",[2]}))},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function u(e){try{l(o.throw(e))}catch(e){i(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,u)}l((o=o.apply(t,n||[])).next())}));var t,n,r,o}))},T=function(e){e.post("/api/upload",(function(e){return t=void 0,n=void 0,o=function(){var t,n,r,o,i;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}(this,(function(a){return t=e.request.files.file,n=t.mimetype,r=t.newFilename,o=t.originalFilename,i=t.size,e.body={mimetype:n,newFilename:r,originalFilename:o,size:i},[2]}))},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function u(e){try{l(o.throw(e))}catch(e){i(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,u)}l((o=o.apply(t,n||[])).next())}));var t,n,r,o}))},O=n(3220),N=!0;var j=n(9664),P=new Set,A=n(2902),U=n(6486),C=n.n(U)().throttle,z=function(){function e(e){var t=this;this.file="",this.version=0,this.autoSaveFile=function(){};var n=e.file,r=e.defaultValue,o=e.version,i=void 0===o?1:o,a=e.versionFixer,u=e.disableAutoSave,l=void 0!==u&&u,s=e.autoSaveWaitMilliseconds,c=void 0===s?8e3:s;this.file=n,this.version=i,this.data=r,l||(this.autoSaveFile=C((function(){t.saveFile()}),c)),this.loadFile(a)}return e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e,this.autoSaveFile()},e.prototype.changeData=function(e){this.data=(0,A.Uy)((function(t){e(t)}))(this.data),this.autoSaveFile()},e.prototype.loadFile=function(e){try{var t=h().readFileSync(this.file,"utf8"),n=JSON.parse(t),r=n.data,o=n.version;this.data=e&&o!==this.version?e(r,o):r}catch(e){console.log("[jsonDb] Error parsing db file, use default value.")}this.saveFile()},e.prototype.saveFile=function(){h().ensureFileSync(this.file),h().writeFileSync(this.file,JSON.stringify({data:this.data,version:this.version,updatedAtString:(new Date).toString(),updatedAtTime:(new Date).getTime()}))},e}();const G=z;var I=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}l((r=r.apply(e,t||[])).next())}))},L=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}},M=f().resolve(k,"./data/db/main.json"),Z={_restartCount:0},J=new G({file:M,version:1,defaultValue:Z,versionFixer:function(e,t){return 1!==t?Z:e}});function R(){return I(this,void 0,void 0,(function(){return L(this,(function(e){return J.changeData((function(e){e._restartCount+=1})),[2]}))}))}!function(){var e,t,n,o;e=this,t=void 0,o=function(){var e;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}(this,(function(t){switch(t.label){case 0:return[4,R()];case 1:return t.sent(),function(e){new j.xF(e,{cors:{origin:"*"}}).on("connection",(function(e){var t={socket:e,data:{userId:""}};P.add(t),e.on("login",(function(e){t.data.userId=e,console.log("[socket] User ".concat(e," logged in."))})),e.on("disconnect",(function(){P.delete(t)}))}))}((function(e){e.use(x()()),e.use(new(v()));var t=f().join(k,"html/frontend"),n=f().join(k,"html/resources");h().ensureDirSync(t),h().ensureDirSync(n),N&&e.use((0,y.ZP)(t+"/index.html")),e.use(w()(t,{maxAge:2592e6,immutable:!0})),e.use(w()(n,{maxAge:2592e6,immutable:!0})),e.use(u()({jsonLimit:"100mb",multipart:!0,formidable:{uploadDir:k+"/html/resources",maxFileSize:1024*_*1024,multiples:!1,onFileBegin:function(e,t){var n=(t.originalFilename||"").replace(/[\/\\]/g,""),r=f().extname(n),o=f().basename(n,r)+"."+(0,O.x0)()+r;t.newFilename=o,t.filepath=k+"/html/resources/"+o}}}));var r=new(i());e.use(r.routes()),function(e){E(e),T(e)}(r)}(n=new r.Z),e=s().createServer(n.callback()))),e.listen(D,(function(){console.log("listening on port:"+D)})),[2]}var n}))},new((n=void 0)||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function u(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}l((o=o.apply(e,t||[])).next())}))}()},9491:e=>{e.exports=require("assert")},852:e=>{e.exports=require("async_hooks")},4300:e=>{e.exports=require("buffer")},2057:e=>{e.exports=require("constants")},6113:e=>{e.exports=require("crypto")},3639:e=>{e.exports=require("domain")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},3477:e=>{e.exports=require("querystring")},2781:e=>{e.exports=require("stream")},1576:e=>{e.exports=require("string_decoder")},9512:e=>{e.exports=require("timers")},4404:e=>{e.exports=require("tls")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},6108:e=>{if("undefined"==typeof bufferutil){var t=new Error("Cannot find module 'bufferutil'");throw t.code="MODULE_NOT_FOUND",t}e.exports=bufferutil},1216:e=>{if(typeof utf-8-validate==="undefined"){var t=new Error("Cannot find module 'utf-8-validate'");throw t.code="MODULE_NOT_FOUND",t}e.exports=utf-8-validate}};var t=require("./runtime.js");t.C(e),t.X(0,[216],(()=>(7010,t(t.s=7010))))})();